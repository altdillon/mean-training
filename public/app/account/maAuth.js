angular.module('app').factory('maAuth', function($http, maIdentity, maNotifier, maUser, $q){	return {		authenticateUser: function(username, password) {			var dfd = $q.defer();			$http.post('/login', {username:username, password:password}).then(function (response) {				if (response.data.success) {					var user = new maUser();					angular.extend(user, response.data.user);					maIdentity.currentUser = user;					dfd.resolve(true);				} else {					dfd.resolve(false);				}			})	        return dfd.promise;		},		logoutUser: function() {			var dfd = $q.defer();			$http.post('/logout', {logout: true}).then(function () {				maIdentity.currentUser = undefined;				dfd.resolve();			})			return dfd.promise;		},		authorizeCurrentUserForRoute: function(role) {	        if(maIdentity.isAuthorized(role)) {    			return true;    		} else {    			return $q.reject('not authorized');    		}		}	};})